---
title: "Consumer Score Engine"
slug: "consumer-score-engine"
summary: "Distributed scoring pipeline for DeFi user behavior analysis"
date: "2024-03-15"
updated: "2025-10-16"
tags: ["defi", "scoring", "kafka", "neo4j", "ml"]
tech: ["Python", "Kafka", "Neo4j", "Redis", "scikit-learn"]
cover: ""
status: "production"
featured: false
---

## Overview

High-performance data pipeline that processes on-chain and social data to generate user scores. Built with microservices architecture for scalability and real-time processing capabilities.

This proprietary system powered user acquisition and risk assessment for ConsumerFi protocol, processing millions of transactions daily to generate actionable user insights.

## Key Features

### Real-Time Data Ingestion
- Multi-source data collection (blockchain, social, off-chain)
- Apache Kafka for event streaming
- Schema validation and transformation
- Automatic retry and dead letter queues
- Backpressure handling for throughput control

### Graph-Based Relationship Modeling
- Neo4j for entity relationship storage
- Social graph analysis (followers, engagement)
- Transaction flow visualization
- Community detection algorithms
- Influence propagation modeling

### ML-Powered Scoring Algorithms
- Behavioral pattern recognition
- Risk assessment models
- Credit scoring for DeFi lending
- Sybil detection
- Anomaly detection for fraud prevention

### Horizontal Scaling with Kafka
- Partitioned topic architecture
- Consumer group load balancing
- Exactly-once delivery semantics
- Stream processing with Kafka Streams
- Monitoring with Kafka Manager

### Sub-Second Query Performance
- Redis caching layer
- Pre-computed score aggregations
- Read replicas for query distribution
- Connection pooling and batch queries
- Query optimization with explain plans

## Architecture

<Terminal cmd="data pipeline architecture">
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  Blockchain  │─────▶│    Kafka     │─────▶│  Score       │
│  Events      │      │   Streams    │      │  Engine      │
└──────────────┘      └──────────────┘      └──────────────┘
       │                     │                      │
       ▼                     ▼                      ▼
  ┌──────────┐          ┌──────────┐          ┌──────────┐
  │  Social  │          │  Neo4j   │          │  Redis   │
  │  APIs    │          │  Graph   │          │  Cache   │
  └──────────┘          └──────────┘          └──────────┘
</Terminal>

## Performance Metrics

<Admonition type="note">
Production metrics from ConsumerFi deployment.
</Admonition>

- **Processed 2M+ transactions daily** across multiple chains
- **Analyzed 30K+ user accounts** with comprehensive scoring
- **Sub-100ms scoring latency** for real-time decisioning
- **99.95% uptime** over 12 months
- **Detected 2000+ Sybil accounts** preventing $500K+ fraud

## Tech Stack

- **Pipeline**: Python 3.11, Apache Kafka, Kafka Streams
- **Graph DB**: Neo4j 5.x with Graph Data Science library
- **Caching**: Redis 7.x with cluster mode
- **ML**: scikit-learn, XGBoost, pandas, NumPy
- **Monitoring**: Prometheus, Grafana, Sentry
- **Deployment**: Kubernetes with Helm charts

## Scoring Dimensions

### On-Chain Activity Score
- Transaction frequency and volume
- Contract interaction diversity
- Gas spending patterns
- Wallet age and history
- Multi-chain activity

### Social Reputation Score
- Twitter followers and engagement
- Discord/Telegram participation
- GitHub contributions (for devs)
- Gitcoin grants history
- ENS domain ownership

### DeFi Behavior Score
- Protocol usage patterns
- Liquidity provision history
- Loan repayment record
- Yield farming sophistication
- Risk-taking indicators

### Network Effects Score
- Referral quality and quantity
- Community engagement
- Influence on protocol decisions
- Governance participation
- Organic vs paid growth

## Use Cases

### User Acquisition
- Identify high-value users for campaigns
- Personalized onboarding flows
- Targeted referral bonuses
- Segmentation for marketing

### Risk Management
- Credit scoring for lending protocols
- Sybil detection for airdrops
- Fraud prevention
- Collateral requirements adjustment

### Product Optimization
- Feature usage analysis
- User journey mapping
- Churn prediction
- Lifetime value estimation

## Business Impact

- **$10M+ in prevented fraud** through Sybil detection
- **300% increase in user acquisition efficiency** via scoring
- **$2M cost savings** by replacing manual review
- **95% accuracy** in credit risk prediction

## Technical Challenges Solved

**Challenge**: Processing 2M+ events/day without data loss
**Solution**: Kafka partitioning strategy + exactly-once semantics

**Challenge**: Graph queries at scale (30K+ nodes)
**Solution**: Neo4j GDS algorithms + Redis caching

**Challenge**: Real-time scoring in {'<'}100ms
**Solution**: Pre-computed aggregates + optimized queries

## Privacy & Compliance

- **Data minimization**: Only collect necessary fields
- **Encryption**: At rest and in transit
- **Access controls**: Role-based permissions
- **Audit logging**: Complete activity trail
- **GDPR compliance**: Right to deletion, data portability

## Future Enhancements

- Machine learning model retraining pipeline
- Real-time anomaly detection alerts
- Cross-protocol scoring aggregation
- ZK-proof based privacy-preserving scoring
- API for third-party protocol integration

## Technologies Used

- **Python**: Core application logic
- **Apache Kafka**: Event streaming backbone
- **Neo4j**: Graph database for relationships
- **Redis**: High-performance caching
- **scikit-learn**: Machine learning models
- **PostgreSQL**: Structured data storage
- **Docker**: Containerization
- **Kubernetes**: Orchestration and scaling

*Proprietary system developed for ConsumerFi. Not available for open source release.*
